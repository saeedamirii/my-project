<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>برش میوه</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }body {
  font-family: sans-serif;
  background-color: #d7f0f7;
}

.game-container {
  max-width: 600px;
  margin: auto;
  position: relative;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  background-color: #4caf50;
  color: white;
}

#game-area {
  position: relative;
  height: 500px;
  background: url("https://images.unsplash.com/photo-1570197781548-6b4e6bb1fb42") center/cover no-repeat;
  overflow: hidden;
  border: 2px solid #333;
}

.fruit, .fruit-half {
  position: absolute;
  width: 60px;
  height: 60px;
  user-select: none;
  pointer-events: none;
  transition: transform 0.6s ease, top 1s ease;
}

.fruit-half.left {
  transform: rotate(-45deg) translateX(-20px);
}
.fruit-half.right {
  transform: rotate(45deg) translateX(20px);
}

#startBtn {
  background: #1b5e20;
  color: white;
  border: none;
  padding: 6px 12px;
  cursor: pointer;
  font-size: 14px;
}

#slash-canvas {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  pointer-events: none;
}

  </style>
</head>
<body>
  <div class="game-container">
    <div class="header">
      <p>امتیاز: <span id="score">0</span></p>
      <p>از دست رفته: <span id="missed">0</span></p>
      <button id="startBtn">شروع بازی</button>
    </div>
    <div id="game-area"></div>
    <canvas id="slash-canvas"></canvas>
  </div>
  <script>
    const gameArea = document.getElementById("game-area");
    const scoreEl = document.getElementById("score");
    const missedEl = document.getElementById("missed");
    const startBtn = document.getElementById("startBtn");
    const canvas = document.getElementById("slash-canvas");
    const ctx = canvas.getContext("2d");canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let fruits = [];
let isRunning = false;
let score = 0;
let missed = 0;
let trail = [];

const fruitImages = [
  "https://cdn-icons-png.flaticon.com/512/590/590685.png",
  "https://cdn-icons-png.flaticon.com/512/590/590682.png",
  "https://cdn-icons-png.flaticon.com/512/590/590686.png",
  "https://cdn-icons-png.flaticon.com/512/590/590688.png",
];

startBtn.onclick = () => {
  resetGame();
  isRunning = true;
  spawnFruits();
  animate();
};

function resetGame() {
  fruits = [];
  score = 0;
  missed = 0;
  scoreEl.textContent = "0";
  missedEl.textContent = "0";
  gameArea.innerHTML = "";
}

function spawnFruits() {
  if (!isRunning) return;

  const fruit = {
    x: Math.random() * (gameArea.clientWidth - 60),
    y: gameArea.clientHeight,
    vx: (Math.random() - 0.5) * 6,
    vy: -12 - Math.random() * 5,
    gravity: 0.4,
    img: new Image(),
    sliced: false,
  };

  fruit.img.src = fruitImages[Math.floor(Math.random() * fruitImages.length)];
  fruits.push(fruit);

  setTimeout(spawnFruits, 1000);
}

function animate() {
  if (!isRunning) return;

  gameArea.innerHTML = "";
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (let i = 0; i < fruits.length; i++) {
    const f = fruits[i];
    if (f.sliced) continue;

    f.x += f.vx;
    f.y += f.vy;
    f.vy += f.gravity;

    if (f.y > gameArea.clientHeight) {
      fruits.splice(i, 1);
      i--;
      missed++;
      missedEl.textContent = missed;
      if (missed >= 3) {
        endGame();
        return;
      }
      continue;
    }

    const fruitEl = document.createElement("img");
    fruitEl.src = f.img.src;
    fruitEl.className = "fruit";
    fruitEl.style.left = `${f.x}px`;
    fruitEl.style.top = `${f.y}px`;
    gameArea.appendChild(fruitEl);
  }

  checkSlice();
  requestAnimationFrame(animate);
}

function checkSlice() {
  fruits.forEach((f, i) => {
    if (f.sliced) return;

    for (const p of trail) {
      const insideX = p.x >= f.x && p.x <= f.x + 60;
      const insideY = p.y >= f.y && p.y <= f.y + 60;
      if (insideX && insideY) {
        f.sliced = true;
        score++;
        scoreEl.textContent = score;
        createFruitHalves(f);
        fruits.splice(i, 1);
        break;
      }
    }
  });
}

function createFruitHalves(fruit) {
  ["left", "right"].forEach((side, index) => {
    const half = document.createElement("img");
    half.src = fruit.img.src;
    half.className = `fruit-half ${side}`;
    half.style.left = `${fruit.x}px`;
    half.style.top = `${fruit.y}px`;
    gameArea.appendChild(half);
    setTimeout(() => {
      half.style.top = `${fruit.y + 150}px`;
      half.style.opacity = 0;
    }, 50);
    setTimeout(() => gameArea.removeChild(half), 1500);
  });
}

function endGame() {
  isRunning = false;
  alert(`بازی تمام شد! امتیاز شما: ${score}`);
}

canvas.addEventListener("mousemove", (e) => {
  trail.push({ x: e.clientX, y: e.clientY });
  if (trail.length > 10) trail.shift();
});

canvas.addEventListener("touchmove", (e) => {
  const t = e.touches[0];
  trail.push({ x: t.clientX, y: t.clientY });
  if (trail.length > 10) trail.shift();
});

  </script>
</body>
</html>
